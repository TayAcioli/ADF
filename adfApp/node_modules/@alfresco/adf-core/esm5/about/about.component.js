/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { AuthenticationService } from '../services/authentication.service';
import { DiscoveryApiService } from '../services/discovery-api.service';
import { ObjectDataTableAdapter } from '../datatable/data/object-datatable-adapter';
import { AppConfigService, AppConfigValues } from '../app-config/app-config.service';
var AboutComponent = /** @class */ (function () {
    function AboutComponent(http, appConfig, authService, discovery) {
        this.http = http;
        this.appConfig = appConfig;
        this.authService = authService;
        this.discovery = discovery;
        this.githubUrlCommitAlpha = 'https://github.com/Alfresco/alfresco-ng2-components/commits/';
        this.ecmHost = '';
        this.bpmHost = '';
        this.ecmVersion = null;
        this.bpmVersion = null;
    }
    /**
     * @return {?}
     */
    AboutComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.authService.isEcmLoggedIn()) {
            this.discovery.getEcmProductInfo().subscribe(function (ecmVers) {
                _this.ecmVersion = ecmVers;
                _this.modules = new ObjectDataTableAdapter(_this.ecmVersion.modules, [
                    { type: 'text', key: 'id', title: 'ID', sortable: true },
                    { type: 'text', key: 'title', title: 'Title', sortable: true },
                    { type: 'text', key: 'version', title: 'Description', sortable: true },
                    { type: 'text', key: 'installDate', title: 'Install Date', sortable: true },
                    { type: 'text', key: 'installState', title: 'Install State', sortable: true },
                    { type: 'text', key: 'versionMin', title: 'Version Minor', sortable: true },
                    { type: 'text', key: 'versionMax', title: 'Version Max', sortable: true }
                ]);
                _this.status = new ObjectDataTableAdapter([_this.ecmVersion.status], [
                    { type: 'text', key: 'isReadOnly', title: 'ReadOnly', sortable: true },
                    { type: 'text', key: 'isAuditEnabled', title: 'Is Audit Enable', sortable: true },
                    { type: 'text', key: 'isQuickShareEnabled', title: 'Is quick shared enable', sortable: true },
                    { type: 'text', key: 'isThumbnailGenerationEnabled', title: 'Thumbnail Generation', sortable: true }
                ]);
                _this.license = new ObjectDataTableAdapter([_this.ecmVersion.license], [
                    { type: 'text', key: 'issuedAt', title: 'Issued At', sortable: true },
                    { type: 'text', key: 'expiresAt', title: 'Expires At', sortable: true },
                    { type: 'text', key: 'remainingDays', title: 'Remaining Days', sortable: true },
                    { type: 'text', key: 'holder', title: 'Holder', sortable: true },
                    { type: 'text', key: 'mode', title: 'Mode', sortable: true },
                    { type: 'text', key: 'isClusterEnabled', title: 'Is Cluster Enabled', sortable: true },
                    { type: 'text', key: 'isCryptodocEnabled', title: 'Is Cryptodoc Enable', sortable: true }
                ]);
            });
        }
        if (this.authService.isBpmLoggedIn()) {
            this.discovery.getBpmProductInfo().subscribe(function (bpmVers) {
                _this.bpmVersion = bpmVers;
            });
        }
        this.http.get('/versions.json?' + new Date()).subscribe(function (response) {
            /** @type {?} */
            var regexp = new RegExp('^(@alfresco)');
            /** @type {?} */
            var alfrescoPackages = Object.keys(response.dependencies).filter(function (val) {
                return regexp.test(val);
            });
            /** @type {?} */
            var alfrescoPackagesTableRepresentation = [];
            alfrescoPackages.forEach(function (val) {
                alfrescoPackagesTableRepresentation.push({
                    name: val,
                    version: response.dependencies[val].version
                });
            });
            _this.gitHubLinkCreation(alfrescoPackagesTableRepresentation);
            _this.data = new ObjectDataTableAdapter(alfrescoPackagesTableRepresentation, [
                { type: 'text', key: 'name', title: 'Name', sortable: true },
                { type: 'text', key: 'version', title: 'Version', sortable: true }
            ]);
        });
        this.ecmHost = this.appConfig.get(AppConfigValues.ECMHOST);
        this.bpmHost = this.appConfig.get(AppConfigValues.BPMHOST);
    };
    /**
     * @param {?} alfrescoPackagesTableRepresentation
     * @return {?}
     */
    AboutComponent.prototype.gitHubLinkCreation = /**
     * @param {?} alfrescoPackagesTableRepresentation
     * @return {?}
     */
    function (alfrescoPackagesTableRepresentation) {
        /** @type {?} */
        var corePackage = alfrescoPackagesTableRepresentation.find(function (packageUp) {
            return packageUp.name === '@alfresco/adf-core';
        });
        if (corePackage) {
            /** @type {?} */
            var commitIsh = corePackage.version.split('-');
            if (commitIsh.length > 1) {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + commitIsh[1];
            }
            else {
                this.githubUrlCommitAlpha = this.githubUrlCommitAlpha + corePackage.version;
            }
        }
    };
    AboutComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-about',
                    template: "<div class=\"about-container\">\n    <h3>Server settings</h3>\n    <mat-list>\n        <small>The values below are taken from the AppConfigService </small>\n        <mat-list-item>\n            <h4 matLine> Alfresco Process Services URL: {{ bpmHost }}</h4>\n        </mat-list-item>\n        <mat-divider></mat-divider>\n        <mat-list-item>\n            <h4 matLine>Alfresco Content Services URL: {{ ecmHost }}</h4>\n        </mat-list-item>\n    </mat-list>\n\n    <h3>Product Versions</h3>\n    <div *ngIf=\"bpmVersion\">\n        <h3>BPM</h3>\n        <label> Edition </label> {{ bpmVersion.edition }}\n        <p></p>\n        <label> Version </label> {{ bpmVersion.majorVersion }}.{{ bpmVersion.minorVersion }}.{{ bpmVersion.revisionVersion }}\n    </div>\n    <div *ngIf=\"ecmVersion\">\n        <h3>ECM</h3>\n        <label> Edition </label> {{ ecmVersion.edition }}\n        <p></p>\n        <label> Version </label> {{ ecmVersion.version.display }}\n        <p></p>\n        <h4>License</h4>\n        <adf-datatable [data]=\"license\"></adf-datatable>\n\n        <h4> Status</h4>\n        <adf-datatable [data]=\"status\"></adf-datatable>\n\n        <h4>Modules</h4>\n\n        <adf-datatable [data]=\"modules\"></adf-datatable>\n    </div>\n\n    <div *ngIf=\"githubUrlCommitAlpha\">\n        <h3>Source code</h3>\n        <small>You are running the project based on the following commit:</small>\n        <div>\n            <a [href]=\"githubUrlCommitAlpha\">{{githubUrlCommitAlpha}}</a>\n        </div>\n    </div>\n\n    <h3>Packages</h3>\n    <small>Current project is using the following ADF libraries:</small>\n    <adf-datatable [data]=\"data\"></adf-datatable>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".about-container{padding:10px}.adf-table-version{width:60%;border:0;border-spacing:0;text-align:center}"]
                }] }
    ];
    /** @nocollapse */
    AboutComponent.ctorParameters = function () { return [
        { type: HttpClient },
        { type: AppConfigService },
        { type: AuthenticationService },
        { type: DiscoveryApiService }
    ]; };
    return AboutComponent;
}());
export { AboutComponent };
if (false) {
    /** @type {?} */
    AboutComponent.prototype.data;
    /** @type {?} */
    AboutComponent.prototype.status;
    /** @type {?} */
    AboutComponent.prototype.license;
    /** @type {?} */
    AboutComponent.prototype.modules;
    /** @type {?} */
    AboutComponent.prototype.githubUrlCommitAlpha;
    /** @type {?} */
    AboutComponent.prototype.ecmHost;
    /** @type {?} */
    AboutComponent.prototype.bpmHost;
    /** @type {?} */
    AboutComponent.prototype.ecmVersion;
    /** @type {?} */
    AboutComponent.prototype.bpmVersion;
    /** @type {?} */
    AboutComponent.prototype.http;
    /** @type {?} */
    AboutComponent.prototype.appConfig;
    /** @type {?} */
    AboutComponent.prototype.authService;
    /** @type {?} */
    AboutComponent.prototype.discovery;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWJvdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQGFsZnJlc2NvL2FkZi1jb3JlLyIsInNvdXJjZXMiOlsiYWJvdXQvYWJvdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxTQUFTLEVBQVUsaUJBQWlCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckUsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBRTNFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ3BGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQzs7SUFzQmpGLHdCQUFvQixJQUFnQixFQUNoQixXQUNBLGFBQ0E7UUFIQSxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGNBQVMsR0FBVCxTQUFTO1FBQ1QsZ0JBQVcsR0FBWCxXQUFXO1FBQ1gsY0FBUyxHQUFULFNBQVM7b0NBWE4sOERBQThEO3VCQUUzRSxFQUFFO3VCQUNGLEVBQUU7MEJBRXlCLElBQUk7MEJBQ0osSUFBSTtLQU14Qzs7OztJQUVELGlDQUFROzs7SUFBUjtRQUFBLGlCQW1FQztRQWpFRyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxFQUFFLEVBQUU7WUFDbEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFDLE9BQU87Z0JBQ2pELEtBQUksQ0FBQyxVQUFVLEdBQUcsT0FBTyxDQUFDO2dCQUUxQixLQUFJLENBQUMsT0FBTyxHQUFHLElBQUksc0JBQXNCLENBQUMsS0FBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUU7b0JBQy9ELEVB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QkFaUSxVQUFVO2dCQUtWLGdCQUFnQjtnQkFKaEIscUJBQXFCO2dCQUVyQixtQkFBbUI7O3lCQXJCNUI7O1NBK0JhLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNiBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0VuY2Fwc3VsYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBBdXRoZW50aWNhdGlvblNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hdXRoZW50aWNhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEJwbVByb2R1Y3RWZXJzaW9uTW9kZWwsIEVjbVByb2R1Y3RWZXJzaW9uTW9kZWwgfSBmcm9tICcuLi9tb2RlbHMvcHJvZHVjdC12ZXJzaW9uLm1vZGVsJztcbmltcG9ydCB7IERpc2NvdmVyeUFwaVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9kaXNjb3ZlcnktYXBpLnNlcnZpY2UnO1xuaW1wb3J0IHsgT2JqZWN0RGF0YVRhYmxlQWRhcHRlciB9IGZyb20gJy4uL2RhdGF0YWJsZS9kYXRhL29iamVjdC1kYXRhdGFibGUtYWRhcHRlcic7XG5pbXBvcnQgeyBBcHBDb25maWdTZXJ2aWNlLCBBcHBDb25maWdWYWx1ZXMgfSBmcm9tICcuLi9hcHAtY29uZmlnL2FwcC1jb25maWcuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiAnYWRmLWFib3V0JyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vYWJvdXQuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL2Fib3V0LmNvbXBvbmVudC5zY3NzJ10sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBBYm91dENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgICBkYXRhOiBPYmplY3REYXRhVGFibGVBZGFwdGVyO1xuICAgIHN0YXR1czogT2JqZWN0RGF0YVRhYmxlQWRhcHRlcjtcbiAgICBsaWNlbnNlOiBPYmplY3REYXRhVGFibGVBZGFwdGVyO1xuICAgIG1vZHVsZXM6IE9iamVjdERhdGFUYWJsZUFkYXB0ZXI7XG4gICAgZ2l0aHViVXJsQ29tbWl0QWxwaGEgPSAnaHR0cHM6Ly9naXRodWIuY29tL0FsZnJlc2NvL2FsZnJlc2NvLW5nMi1jb21wb25lbnRzL2NvbW1pdHMvJztcblxuICAgIGVjbUhvc3QgPSAnJztcbiAgICBicG1Ib3N0ID0gJyc7XG5cbiAgICBlY21WZXJzaW9uOiBFY21Qcm9kdWN0VmVyc2lvbk1vZGVsID0gbnVsbDtcbiAgICBicG1WZXJzaW9uOiBCcG1Qcm9kdWN0VmVyc2lvbk1vZGVsID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoZW50aWNhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkaXNjb3Zlcnk6IERpc2NvdmVyeUFwaVNlcnZpY2UpIHtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcblxuICAgICAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc0VjbUxvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJ5LmdldEVjbVByb2R1Y3RJbmZvKCkuc3Vic2NyaWJlKChlY21WZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5lY21WZXJzaW9uID0gZWNtVmVycztcblxuICAgICAgICAgICAgICAgIHRoaXMubW9kdWxlcyA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKHRoaXMuZWNtVmVyc2lvbi5tb2R1bGVzLCBbXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpZCcsIHRpdGxlOiAnSUQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAndGl0bGUnLCB0aXRsZTogJ1RpdGxlJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3ZlcnNpb24nLCB0aXRsZTogJ0Rlc2NyaXB0aW9uJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2luc3RhbGxEYXRlJywgdGl0bGU6ICdJbnN0YWxsIERhdGUnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaW5zdGFsbFN0YXRlJywgdGl0bGU6ICdJbnN0YWxsIFN0YXRlJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3ZlcnNpb25NaW4nLCB0aXRsZTogJ1ZlcnNpb24gTWlub3InLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAndmVyc2lvbk1heCcsIHRpdGxlOiAnVmVyc2lvbiBNYXgnLCBzb3J0YWJsZTogdHJ1ZSB9XG4gICAgICAgICAgICAgICAgXSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnN0YXR1cyA9IG5ldyBPYmplY3REYXRhVGFibGVBZGFwdGVyKFt0aGlzLmVjbVZlcnNpb24uc3RhdHVzXSwgW1xuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNSZWFkT25seScsIHRpdGxlOiAnUmVhZE9ubHknLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNBdWRpdEVuYWJsZWQnLCB0aXRsZTogJ0lzIEF1ZGl0IEVuYWJsZScsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpc1F1aWNrU2hhcmVFbmFibGVkJywgdGl0bGU6ICdJcyBxdWljayBzaGFyZWQgZW5hYmxlJywgc29ydGFibGU6IHRydWUgfSxcbiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ2lzVGh1bWJuYWlsR2VuZXJhdGlvbkVuYWJsZWQnLCB0aXRsZTogJ1RodW1ibmFpbCBHZW5lcmF0aW9uJywgc29ydGFibGU6IHRydWUgfVxuICAgICAgICAgICAgICAgIF0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5saWNlbnNlID0gbmV3IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIoW3RoaXMuZWNtVmVyc2lvbi5saWNlbnNlXSwgW1xuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNzdWVkQXQnLCB0aXRsZTogJ0lzc3VlZCBBdCcsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdleHBpcmVzQXQnLCB0aXRsZTogJ0V4cGlyZXMgQXQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAncmVtYWluaW5nRGF5cycsIHRpdGxlOiAnUmVtYWluaW5nIERheXMnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaG9sZGVyJywgdGl0bGU6ICdIb2xkZXInLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnbW9kZScsIHRpdGxlOiAnTW9kZScsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgICAgIHsgdHlwZTogJ3RleHQnLCBrZXk6ICdpc0NsdXN0ZXJFbmFibGVkJywgdGl0bGU6ICdJcyBDbHVzdGVyIEVuYWJsZWQnLCBzb3J0YWJsZTogdHJ1ZSB9LFxuICAgICAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnaXNDcnlwdG9kb2NFbmFibGVkJywgdGl0bGU6ICdJcyBDcnlwdG9kb2MgRW5hYmxlJywgc29ydGFibGU6IHRydWUgfVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5hdXRoU2VydmljZS5pc0JwbUxvZ2dlZEluKCkpIHtcbiAgICAgICAgICAgIHRoaXMuZGlzY292ZXJ5LmdldEJwbVByb2R1Y3RJbmZvKCkuc3Vic2NyaWJlKChicG1WZXJzKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5icG1WZXJzaW9uID0gYnBtVmVycztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5odHRwLmdldCgnL3ZlcnNpb25zLmpzb24/JyArIG5ldyBEYXRlKCkpLnN1YnNjcmliZSgocmVzcG9uc2U6IGFueSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVnZXhwID0gbmV3IFJlZ0V4cCgnXihAYWxmcmVzY28pJyk7XG5cbiAgICAgICAgICAgIGNvbnN0IGFsZnJlc2NvUGFja2FnZXMgPSBPYmplY3Qua2V5cyhyZXNwb25zZS5kZXBlbmRlbmNpZXMpLmZpbHRlcigodmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2V4cC50ZXN0KHZhbCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgY29uc3QgYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24gPSBbXTtcbiAgICAgICAgICAgIGFsZnJlc2NvUGFja2FnZXMuZm9yRWFjaCgodmFsKSA9PiB7XG4gICAgICAgICAgICAgICAgYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24ucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IHZhbCxcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogcmVzcG9uc2UuZGVwZW5kZW5jaWVzW3ZhbF0udmVyc2lvblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRoaXMuZ2l0SHViTGlua0NyZWF0aW9uKGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uKTtcblxuICAgICAgICAgICAgdGhpcy5kYXRhID0gbmV3IE9iamVjdERhdGFUYWJsZUFkYXB0ZXIoYWxmcmVzY29QYWNrYWdlc1RhYmxlUmVwcmVzZW50YXRpb24sIFtcbiAgICAgICAgICAgICAgICB7IHR5cGU6ICd0ZXh0Jywga2V5OiAnbmFtZScsIHRpdGxlOiAnTmFtZScsIHNvcnRhYmxlOiB0cnVlIH0sXG4gICAgICAgICAgICAgICAgeyB0eXBlOiAndGV4dCcsIGtleTogJ3ZlcnNpb24nLCB0aXRsZTogJ1ZlcnNpb24nLCBzb3J0YWJsZTogdHJ1ZSB9XG4gICAgICAgICAgICBdKTtcblxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmVjbUhvc3QgPSB0aGlzLmFwcENvbmZpZy5nZXQ8c3RyaW5nPihBcHBDb25maWdWYWx1ZXMuRUNNSE9TVCk7XG4gICAgICAgIHRoaXMuYnBtSG9zdCA9IHRoaXMuYXBwQ29uZmlnLmdldDxzdHJpbmc+KEFwcENvbmZpZ1ZhbHVlcy5CUE1IT1NUKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdpdEh1YkxpbmtDcmVhdGlvbihhbGZyZXNjb1BhY2thZ2VzVGFibGVSZXByZXNlbnRhdGlvbik6IHZvaWQge1xuICAgICAgICBjb25zdCBjb3JlUGFja2FnZSA9IGFsZnJlc2NvUGFja2FnZXNUYWJsZVJlcHJlc2VudGF0aW9uLmZpbmQoKHBhY2thZ2VVcCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHBhY2thZ2VVcC5uYW1lID09PSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGNvcmVQYWNrYWdlKSB7XG4gICAgICAgICAgICBjb25zdCBjb21taXRJc2ggPSBjb3JlUGFja2FnZS52ZXJzaW9uLnNwbGl0KCctJyk7XG4gICAgICAgICAgICBpZiAoY29tbWl0SXNoLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdpdGh1YlVybENvbW1pdEFscGhhID0gdGhpcy5naXRodWJVcmxDb21taXRBbHBoYSArIGNvbW1pdElzaFsxXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5naXRodWJVcmxDb21taXRBbHBoYSA9IHRoaXMuZ2l0aHViVXJsQ29tbWl0QWxwaGEgKyBjb3JlUGFja2FnZS52ZXJzaW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19