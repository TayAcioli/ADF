/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, Inject, Optional, EventEmitter, Output } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material';
import { NodesApiService, TranslationService } from '@alfresco/adf-core';
import { forbidEndingDot, forbidOnlySpaces, forbidSpecialCharacters } from './folder-name.validators';
var FolderDialogComponent = /** @class */ (function () {
    function FolderDialogComponent(formBuilder, dialog, nodesApi, translation, data) {
        this.formBuilder = formBuilder;
        this.dialog = dialog;
        this.nodesApi = nodesApi;
        this.translation = translation;
        this.data = data;
        this.folder = null;
        /**
         * Emitted when the edit/create folder give error for example a folder with same name already exist
         */
        this.error = new EventEmitter();
        /**
         * Emitted when the edit/create folder is successfully created/mmodified
         */
        this.success = new EventEmitter();
        this.editTitle = 'CORE.FOLDER_DIALOG.EDIT_FOLDER_TITLE';
        this.createTitle = 'CORE.FOLDER_DIALOG.CREATE_FOLDER_TITLE';
        this.nodeType = 'cm:folder';
        if (data) {
            this.editTitle = data.editTitle || this.editTitle;
            this.createTitle = data.createTitle || this.createTitle;
            this.nodeType = data.nodeType || this.nodeType;
        }
    }
    Object.defineProperty(FolderDialogComponent.prototype, "editing", {
        get: /**
         * @return {?}
         */
        function () {
            return !!this.data.folder;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FolderDialogComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var folder = this.data.folder;
        /** @type {?} */
        var name = '';
        /** @type {?} */
        var description = '';
        if (folder) {
            var properties = folder.properties;
            name = folder.name || '';
            description = properties ? properties['cm:description'] : '';
        }
        /** @type {?} */
        var validators = {
            name: [
                Validators.required,
                forbidSpecialCharacters,
                forbidEndingDot,
                forbidOnlySpaces
            ]
        };
        this.form = this.formBuilder.group({
            name: [name, validators.name],
            description: [description]
        });
    };
    Object.defineProperty(FolderDialogComponent.prototype, "name", {
        get: /**
         * @return {?}
         */
        function () {
            var name = this.form.value.name;
            return (name || '').trim();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FolderDialogComponent.prototype, "description", {
        get: /**
         * @return {?}
         */
        function () {
            var description = this.form.value.description;
            return (description || '').trim();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(FolderDialogComponent.prototype, "properties", {
        get: /**
         * @return {?}
         */
        function () {
            var _a = this, title = _a.name, description = _a.description;
            return {
                'cm:title': title,
                'cm:description': description
            };
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    FolderDialogComponent.prototype.create = /**
     * @return {?}
     */
    function () {
        var _a = this, name = _a.name, properties = _a.properties, nodeType = _a.nodeType, nodesApi = _a.nodesApi, parentNodeId = _a.data.parentNodeId;
        return nodesApi.createFolder(parentNodeId, { name: name, properties: properties, nodeType: nodeType });
    };
    /**
     * @return {?}
     */
    FolderDialogComponent.prototype.edit = /**
     * @return {?}
     */
    function () {
        var _a = this, name = _a.name, properties = _a.properties, nodesApi = _a.nodesApi, nodeId = _a.data.folder.id;
        return nodesApi.updateNode(nodeId, { name: name, properties: properties });
    };
    /**
     * @return {?}
     */
    FolderDialogComponent.prototype.submit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        var _a = this, form = _a.form, dialog = _a.dialog, editing = _a.editing;
        if (!form.valid) {
            return;
        }
        (editing ? this.edit() : this.create())
            .subscribe(function (folder) {
            _this.success.emit(folder);
            dialog.close(folder);
        }, function (error) { return _this.handleError(error); });
    };
    /**
     * @param {?} error
     * @return {?}
     */
    FolderDialogComponent.prototype.handleError = /**
     * @param {?} error
     * @return {?}
     */
    function (error) {
        /** @type {?} */
        var errorMessage = 'CORE.MESSAGES.ERRORS.GENERIC';
        try {
            var statusCode = JSON.parse(error.message).error.statusCode;
            if (statusCode === 409) {
                errorMessage = 'CORE.MESSAGES.ERRORS.EXISTENT_FOLDER';
            }
        }
        catch (err) { /* Do nothing, keep the original message */
            /* Do nothing, keep the original message */ 
        }
        this.error.emit(this.translation.instant(errorMessage));
        return error;
    };
    FolderDialogComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-folder-dialog',
                    template: "<h2 mat-dialog-title>\n    {{ (editing ? editTitle : createTitle) | translate }}\n</h2>\n\n<mat-dialog-content>\n    <form [formGroup]=\"form\" (submit)=\"submit()\">\n        <mat-form-field class=\"adf-full-width\">\n            <input\n                id=\"adf-folder-name-input\"\n                placeholder=\"{{ 'CORE.FOLDER_DIALOG.FOLDER_NAME.LABEL' | translate }}\"\n                matInput\n                required\n                [formControl]=\"form.controls['name']\"/>\n\n            <mat-hint *ngIf=\"form.controls['name'].dirty\">\n                <span *ngIf=\"form.controls['name'].errors?.required\">\n                    {{ 'CORE.FOLDER_DIALOG.FOLDER_NAME.ERRORS.REQUIRED' | translate }}\n                </span>\n\n                <span *ngIf=\"!form.controls['name'].errors?.required && form.controls['name'].errors?.message\">\n                    {{ form.controls['name'].errors?.message | translate }}\n                </span>\n            </mat-hint>\n        </mat-form-field>\n\n        <br />\n        <br />\n\n        <mat-form-field class=\"adf-full-width\">\n            <textarea\n                id=\"adf-folder-description-input\"\n                matInput\n                placeholder=\"{{ 'CORE.FOLDER_DIALOG.FOLDER_DESCRIPTION.LABEL' | translate }}\"\n                rows=\"4\"\n                [formControl]=\"form.controls['description']\"></textarea>\n        </mat-form-field>\n    </form>\n</mat-dialog-content>\n\n<mat-dialog-actions class=\"adf-dialog-buttons\">\n    <span class=\"adf-fill-remaining-space\"></span>\n\n    <button\n        mat-button\n        id=\"adf-folder-cancel-button\"\n        mat-dialog-close>\n        {{ 'CORE.FOLDER_DIALOG.CANCEL_BUTTON.LABEL' | translate }}\n    </button>\n\n    <button class=\"adf-dialog-action-button\"\n            id=\"adf-folder-create-button\"\n            mat-button\n            (click)=\"submit()\"\n            [disabled]=\"!form.valid\">\n        {{\n        (editing\n        ? 'CORE.FOLDER_DIALOG.UPDATE_BUTTON.LABEL'\n        : 'CORE.FOLDER_DIALOG.CREATE_BUTTON.LABEL'\n        ) | translate\n        }}\n    </button>\n</mat-dialog-actions>\n",
                    styles: [".adf-fill-remaining-space{flex:1 1 auto}.adf-full-width,.adf-lock-file-name .mat-checkbox-layout{width:100%}.adf-lock-file-name .mat-checkbox-label{text-overflow:ellipsis;overflow:hidden}.adf-lock-file-name .mat-checkbox-inner-container{margin:auto 8px auto 0}"]
                }] }
    ];
    /** @nocollapse */
    FolderDialogComponent.ctorParameters = function () { return [
        { type: FormBuilder },
        { type: MatDialogRef },
        { type: NodesApiService },
        { type: TranslationService },
        { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    FolderDialogComponent.propDecorators = {
        error: [{ type: Output }],
        success: [{ type: Output }]
    };
    return FolderDialogComponent;
}());
export { FolderDialogComponent };
if (false) {
    /** @type {?} */
    FolderDialogComponent.prototype.form;
    /** @type {?} */
    FolderDialogComponent.prototype.folder;
    /**
     * Emitted when the edit/create folder give error for example a folder with same name already exist
     * @type {?}
     */
    FolderDialogComponent.prototype.error;
    /**
     * Emitted when the edit/create folder is successfully created/mmodified
     * @type {?}
     */
    FolderDialogComponent.prototype.success;
    /** @type {?} */
    FolderDialogComponent.prototype.editTitle;
    /** @type {?} */
    FolderDialogComponent.prototype.createTitle;
    /** @type {?} */
    FolderDialogComponent.prototype.nodeType;
    /** @type {?} */
    FolderDialogComponent.prototype.formBuilder;
    /** @type {?} */
    FolderDialogComponent.prototype.dialog;
    /** @type {?} */
    FolderDialogComponent.prototype.nodesApi;
    /** @type {?} */
    FolderDialogComponent.prototype.translation;
    /** @type {?} */
    FolderDialogComponent.prototype.data;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9sZGVyLmRpYWxvZy5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImRpYWxvZ3MvZm9sZGVyLmRpYWxvZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1CQSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBVSxRQUFRLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxRixPQUFPLEVBQUUsV0FBVyxFQUFhLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxlQUFlLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFHbEUsT0FBTyxFQUFFLGVBQWUsRUFBRSxrQkFBa0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXpFLE9BQU8sRUFBRSxlQUFlLEVBQUUsZ0JBQWdCLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQzs7SUEyQmxHLCtCQUNZLGFBQ0EsUUFDQSxVQUNBLGFBR0QsSUFBUztRQU5SLGdCQUFXLEdBQVgsV0FBVztRQUNYLFdBQU0sR0FBTixNQUFNO1FBQ04sYUFBUSxHQUFSLFFBQVE7UUFDUixnQkFBVyxHQUFYLFdBQVc7UUFHWixTQUFJLEdBQUosSUFBSSxDQUFLO3NCQXZCYSxJQUFJOzs7O3FCQUtWLElBQUksWUFBWSxFQUFPOzs7O3VCQUtyQixJQUFJLFlBQVksRUFBMEI7eUJBRTNELHNDQUFzQzsyQkFDcEMsd0NBQXdDO3dCQUMzQyxXQUFXO1FBV2xCLElBQUksSUFBSSxFQUFFO1lBQ04sSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDbEQsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUM7WUFDeEQsSUFBSSxDQUFDLFFB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LENBQ3JDLENBQUM7S0FDVDs7Ozs7SUFFRCwyQ0FBVzs7OztJQUFYLFVBQVksS0FBVTs7UUFDbEIsSUFBSSxZQUFZLEdBQUcsOEJBQThCLENBQUM7UUFFbEQsSUFBSTtZQUNpQixJQUFBLHVEQUFVLENBQWlDO1lBRTVELElBQUksVUFBVSxLQUFLLEdBQUcsRUFBRTtnQkFDcEIsWUFBWSxHQUFHLHNDQUFzQyxDQUFDO2FBQ3pEO1NBQ0o7UUFBQyxPQUFPLEdBQUcsRUFBRSxFQUFFLDJDQUEyQzs7U0FBRTtRQUU3RCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBRXhELE9BQU8sS0FBSyxDQUFDO0tBQ2hCOztnQkFwSUosU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxtQkFBbUI7b0JBRTdCLHNuRUFBbUM7O2lCQUN0Qzs7OztnQkFaUSxXQUFXO2dCQUNNLFlBQVk7Z0JBRzdCLGVBQWU7Z0JBQUUsa0JBQWtCO2dEQWtDbkMsUUFBUSxZQUNSLE1BQU0sU0FBQyxlQUFlOzs7d0JBbEIxQixNQUFNOzBCQUtOLE1BQU07O2dDQTlDWDs7U0FpQ2EscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIEluamVjdCwgT25Jbml0LCBPcHRpb25hbCwgRXZlbnRFbWl0dGVyLCBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtR3JvdXAsIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNQVRfRElBTE9HX0RBVEEsIE1hdERpYWxvZ1JlZiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcblxuaW1wb3J0IHsgTWluaW1hbE5vZGVFbnRyeUVudGl0eSB9IGZyb20gJ2FsZnJlc2NvLWpzLWFwaSc7XG5pbXBvcnQgeyBOb2Rlc0FwaVNlcnZpY2UsIFRyYW5zbGF0aW9uU2VydmljZSB9IGZyb20gJ0BhbGZyZXNjby9hZGYtY29yZSc7XG5cbmltcG9ydCB7IGZvcmJpZEVuZGluZ0RvdCwgZm9yYmlkT25seVNwYWNlcywgZm9yYmlkU3BlY2lhbENoYXJhY3RlcnMgfSBmcm9tICcuL2ZvbGRlci1uYW1lLnZhbGlkYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1mb2xkZXItZGlhbG9nJyxcbiAgICBzdHlsZVVybHM6IFsnLi9mb2xkZXIuZGlhbG9nLnNjc3MnXSxcbiAgICB0ZW1wbGF0ZVVybDogJy4vZm9sZGVyLmRpYWxvZy5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBGb2xkZXJEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXG4gICAgZm9ybTogRm9ybUdyb3VwO1xuXG4gICAgZm9sZGVyOiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5ID0gbnVsbDtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGVkaXQvY3JlYXRlIGZvbGRlciBnaXZlIGVycm9yIGZvciBleGFtcGxlIGEgZm9sZGVyIHdpdGggc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RcbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIC8qKiBFbWl0dGVkIHdoZW4gdGhlIGVkaXQvY3JlYXRlIGZvbGRlciBpcyBzdWNjZXNzZnVsbHkgY3JlYXRlZC9tbW9kaWZpZWRcbiAgICAgKi9cbiAgICBAT3V0cHV0KClcbiAgICBzdWNjZXNzOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8TWluaW1hbE5vZGVFbnRyeUVudGl0eT4oKTtcblxuICAgIGVkaXRUaXRsZSA9ICdDT1JFLkZPTERFUl9ESUFMT0cuRURJVF9GT0xERVJfVElUTEUnO1xuICAgIGNyZWF0ZVRpdGxlID0gJ0NPUkUuRk9MREVSX0RJQUxPRy5DUkVBVEVfRk9MREVSX1RJVExFJztcbiAgICBub2RlVHlwZSA9ICdjbTpmb2xkZXInO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgICAgICBwcml2YXRlIGRpYWxvZzogTWF0RGlhbG9nUmVmPEZvbGRlckRpYWxvZ0NvbXBvbmVudD4sXG4gICAgICAgIHByaXZhdGUgbm9kZXNBcGk6IE5vZGVzQXBpU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSB0cmFuc2xhdGlvbjogVHJhbnNsYXRpb25TZXJ2aWNlLFxuICAgICAgICBAT3B0aW9uYWwoKVxuICAgICAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSlcbiAgICAgICAgcHVibGljIGRhdGE6IGFueVxuICAgICkge1xuICAgICAgICBpZiAoZGF0YSkge1xuICAgICAgICAgICAgdGhpcy5lZGl0VGl0bGUgPSBkYXRhLmVkaXRUaXRsZSB8fCB0aGlzLmVkaXRUaXRsZTtcbiAgICAgICAgICAgIHRoaXMuY3JlYXRlVGl0bGUgPSBkYXRhLmNyZWF0ZVRpdGxlIHx8IHRoaXMuY3JlYXRlVGl0bGU7XG4gICAgICAgICAgICB0aGlzLm5vZGVUeXBlID0gZGF0YS5ub2RlVHlwZSB8fCB0aGlzLm5vZGVUeXBlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZ2V0IGVkaXRpbmcoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuZGF0YS5mb2xkZXI7XG4gICAgfVxuXG4gICAgbmdPbkluaXQoKSB7XG4gICAgICAgIGNvbnN0IHsgZm9sZGVyIH0gPSB0aGlzLmRhdGE7XG4gICAgICAgIGxldCBuYW1lID0gJyc7XG4gICAgICAgIGxldCBkZXNjcmlwdGlvbiA9ICcnO1xuXG4gICAgICAgIGlmIChmb2xkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcHJvcGVydGllcyB9ID0gZm9sZGVyO1xuXG4gICAgICAgICAgICBuYW1lID0gZm9sZGVyLm5hbWUgfHwgJyc7XG4gICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHByb3BlcnRpZXMgPyBwcm9wZXJ0aWVzWydjbTpkZXNjcmlwdGlvbiddIDogJyc7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB2YWxpZGF0b3JzID0ge1xuICAgICAgICAgICAgbmFtZTogW1xuICAgICAgICAgICAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsXG4gICAgICAgICAgICAgICAgZm9yYmlkU3BlY2lhbENoYXJhY3RlcnMsXG4gICAgICAgICAgICAgICAgZm9yYmlkRW5kaW5nRG90LFxuICAgICAgICAgICAgICAgIGZvcmJpZE9ubHlTcGFjZXNcbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgICAgICAgIG5hbWU6IFsgbmFtZSwgdmFsaWRhdG9ycy5uYW1lIF0sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogWyBkZXNjcmlwdGlvbiBdXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldCBuYW1lKCk6IHN0cmluZyB7XG4gICAgICAgIGxldCB7IG5hbWUgfSA9IHRoaXMuZm9ybS52YWx1ZTtcblxuICAgICAgICByZXR1cm4gKG5hbWUgfHwgJycpLnRyaW0oKTtcbiAgICB9XG5cbiAgICBnZXQgZGVzY3JpcHRpb24oKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IHsgZGVzY3JpcHRpb24gfSA9IHRoaXMuZm9ybS52YWx1ZTtcblxuICAgICAgICByZXR1cm4gKGRlc2NyaXB0aW9uIHx8ICcnKS50cmltKCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXQgcHJvcGVydGllcygpOiBhbnkge1xuICAgICAgICBjb25zdCB7IG5hbWU6IHRpdGxlLCBkZXNjcmlwdGlvbiB9ID0gdGhpcztcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgJ2NtOnRpdGxlJzogdGl0bGUsXG4gICAgICAgICAgICAnY206ZGVzY3JpcHRpb24nOiBkZXNjcmlwdGlvblxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgY3JlYXRlKCk6IE9ic2VydmFibGU8TWluaW1hbE5vZGVFbnRyeUVudGl0eT4ge1xuICAgICAgICBjb25zdCB7IG5hbWUsIHByb3BlcnRpZXMsIG5vZGVUeXBlLCBub2Rlc0FwaSwgZGF0YTogeyBwYXJlbnROb2RlSWR9IH0gPSB0aGlzO1xuICAgICAgICByZXR1cm4gbm9kZXNBcGkuY3JlYXRlRm9sZGVyKHBhcmVudE5vZGVJZCwgeyBuYW1lLCBwcm9wZXJ0aWVzLCBub2RlVHlwZSB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGVkaXQoKTogT2JzZXJ2YWJsZTxNaW5pbWFsTm9kZUVudHJ5RW50aXR5PiB7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgcHJvcGVydGllcywgbm9kZXNBcGksIGRhdGE6IHsgZm9sZGVyOiB7IGlkOiBub2RlSWQgfX0gfSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBub2Rlc0FwaS51cGRhdGVOb2RlKG5vZGVJZCwgeyBuYW1lLCBwcm9wZXJ0aWVzIH0pO1xuICAgIH1cblxuICAgIHN1Ym1pdCgpIHtcbiAgICAgICAgY29uc3QgeyBmb3JtLCBkaWFsb2csIGVkaXRpbmcgfSA9IHRoaXM7XG5cbiAgICAgICAgaWYgKCFmb3JtLnZhbGlkKSB7IHJldHVybjsgfVxuXG4gICAgICAgIChlZGl0aW5nID8gdGhpcy5lZGl0KCkgOiB0aGlzLmNyZWF0ZSgpKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAoZm9sZGVyOiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc3VjY2Vzcy5lbWl0KGZvbGRlcik7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZy5jbG9zZShmb2xkZXIpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgKGVycm9yKSA9PiB0aGlzLmhhbmRsZUVycm9yKGVycm9yKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBoYW5kbGVFcnJvcihlcnJvcjogYW55KTogYW55IHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICdDT1JFLk1FU1NBR0VTLkVSUk9SUy5HRU5FUklDJztcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBlcnJvcjogeyBzdGF0dXNDb2RlIH0gfSA9IEpTT04ucGFyc2UoZXJyb3IubWVzc2FnZSk7XG5cbiAgICAgICAgICAgIGlmIChzdGF0dXNDb2RlID09PSA0MDkpIHtcbiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAnQ09SRS5NRVNTQUdFUy5FUlJPUlMuRVhJU1RFTlRfRk9MREVSJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7IC8qIERvIG5vdGhpbmcsIGtlZXAgdGhlIG9yaWdpbmFsIG1lc3NhZ2UgKi8gfVxuXG4gICAgICAgIHRoaXMuZXJyb3IuZW1pdCh0aGlzLnRyYW5zbGF0aW9uLmluc3RhbnQoZXJyb3JNZXNzYWdlKSk7XG5cbiAgICAgICAgcmV0dXJuIGVycm9yO1xuICAgIH1cbn1cbiJdfQ==