/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable, Output, EventEmitter } from '@angular/core';
import { Subject } from 'rxjs';
import { AlfrescoApiService, ContentService } from '@alfresco/adf-core';
import { MatDialog } from '@angular/material';
import { DocumentListService } from './document-list.service';
import { ContentNodeDialogService } from '../../content-node-selector/content-node-dialog.service';
import { NodeDownloadDirective } from '../../directives/node-download.directive';
var NodeActionsService = /** @class */ (function () {
    function NodeActionsService(contentDialogService, dialogRef, content, documentListService, apiService, dialog) {
        this.contentDialogService = contentDialogService;
        this.dialogRef = dialogRef;
        this.content = content;
        this.documentListService = documentListService;
        this.apiService = apiService;
        this.dialog = dialog;
        this.error = new EventEmitter();
    }
    /**
     * @param {?} node
     * @return {?}
     */
    NodeActionsService.prototype.downloadNode = /**
     * @param {?} node
     * @return {?}
     */
    function (node) {
        new NodeDownloadDirective(this.apiService, this.dialog)
            .downloadNode(node);
    };
    /**
     * Copy content node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.copyContent = /**
     * Copy content node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('copy', 'content', contentEntry, permission);
    };
    /**
     * Copy folder node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.copyFolder = /**
     * Copy folder node
     *
     * @param {?} contentEntry node to copy
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('copy', 'folder', contentEntry, permission);
    };
    /**
     * Move content node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.moveContent = /**
     * Move content node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('move', 'content', contentEntry, permission);
    };
    /**
     * Move folder node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.moveFolder = /**
     * Move folder node
     *
     * @param {?} contentEntry node to move
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (contentEntry, permission) {
        return this.doFileOperation('move', 'folder', contentEntry, permission);
    };
    /**
     * General method for performing the given operation (copy|move)
     *
     * @param {?} action the action to perform (copy|move)
     * @param {?} type type of the content (content|folder)
     * @param {?} contentEntry the contentEntry which has to have the action performed on
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    NodeActionsService.prototype.doFileOperation = /**
     * General method for performing the given operation (copy|move)
     *
     * @param {?} action the action to perform (copy|move)
     * @param {?} type type of the content (content|folder)
     * @param {?} contentEntry the contentEntry which has to have the action performed on
     * @param {?=} permission permission which is needed to apply the action
     * @return {?}
     */
    function (action, type, contentEntry, permission) {
        var _this = this;
        /** @type {?} */
        var observable = new Subject();
        this.contentDialogService
            .openCopyMoveDialog(action, contentEntry, permission)
            .subscribe(function (selections) {
            /** @type {?} */
            var selection = selections[0];
            _this.documentListService[action + "Node"].call(_this.documentListService, contentEntry.id, selection.id)
                .subscribe(observable.next.bind(observable, "OPERATION.SUCCESS." + type.toUpperCase() + "." + action.toUpperCase()), observable.error.bind(observable));
        }, function (error) {
            observable.error(error);
            return observable;
        });
        return observable;
    };
    NodeActionsService.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    NodeActionsService.ctorParameters = function () { return [
        { type: ContentNodeDialogService },
        { type: MatDialog },
        { type: ContentService },
        { type: DocumentListService },
        { type: AlfrescoApiService },
        { type: MatDialog }
    ]; };
    NodeActionsService.propDecorators = {
        error: [{ type: Output }]
    };
    return NodeActionsService;
}());
export { NodeActionsService };
if (false) {
    /** @type {?} */
    NodeActionsService.prototype.error;
    /** @type {?} */
    NodeActionsService.prototype.contentDialogService;
    /** @type {?} */
    NodeActionsService.prototype.dialogRef;
    /** @type {?} */
    NodeActionsService.prototype.content;
    /** @type {?} */
    NodeActionsService.prototype.documentListService;
    /** @type {?} */
    NodeActionsService.prototype.apiService;
    /** @type {?} */
    NodeActionsService.prototype.dialog;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibm9kZS1hY3Rpb25zLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJkb2N1bWVudC1saXN0L3NlcnZpY2VzL25vZGUtYWN0aW9ucy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUVqRSxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUN4RSxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFOUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDOUQsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDbkcsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMENBQTBDLENBQUM7O0lBUTdFLDRCQUFvQixvQkFBOEMsRUFDL0MsV0FDQSxTQUNDLHFCQUNBLFlBQ0E7UUFMQSx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQTBCO1FBQy9DLGNBQVMsR0FBVCxTQUFTO1FBQ1QsWUFBTyxHQUFQLE9BQU87UUFDTix3QkFBbUIsR0FBbkIsbUJBQW1CO1FBQ25CLGVBQVUsR0FBVixVQUFVO1FBQ1YsV0FBTSxHQUFOLE1BQU07cUJBUEMsSUFBSSxZQUFZLEVBQU87S0FPUjs7Ozs7SUFFMUMseUNBQVk7Ozs7SUFBWixVQUFhLElBQXVCO1FBQ2hDLElBQUkscUJBQXFCLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDO2FBQ2xELFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUMzQjs7Ozs7Ozs7SUFRTSx3Q0FBVzs7Ozs7OztjQUFDLFlBQW9DLEVBQUUsVUFBbUI7UUFDeEUsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDOzs7Ozs7Ozs7SUFTdEUsdUNBQVU7Ozs7Ozs7Y0FBQyxZQUFvQyxFQUFFLFVBQW1CO1FBQ3ZFLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFlBQVksRUFBRSxVQUFVLENBQUMsQ0FBQzs7Ozs7Ozs7O0lBU3JFLHdDQUFXOzs7Ozs7O2NBQUMsWUFBb0MsRUFBRSxVQUFtQjtRQUN4RSxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUM7Ozs7Ozs7OztJQVN0RSx1Q0FBVTs7Ozs7OztjQUFDLFlBQW9DLEVBQUUsVUFBbUI7UUFDdkUsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFDOzs7Ozs7Ozs7OztJQVdwRSw0Q0FBZTs7Ozs7Ozs7O2NBQUMsTUFBYyxFQUFFLElBQVksRUFBRSxZQUFvQyxFQUFFLFVBQW1COzs7UUFDM0csSUFBTSxVQUFVLEdBQW9CLElBQUksT0FBTyxFQUFVLENBQUM7UUFFMUQsSUFBSSxDQUFDLG9CQUFvQjthQUNwQixrQkFBa0IsQ0FBQyxNQUFNLEVBQUUsWUFBWSxFQUFFLFVBQVUsQ0FBQzthQUNwRCxTQUFTLENBQUMsVUFBQyxVQUFvQzs7WUFDNUMsSUFBTSxTQUFTLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLEtBQUksQ0FBQyxtQkFBbUIsQ0FBSSxNQUFNLFNBQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsbUJBQW1CLEVBQUUsWUFBWSxDQUFDLEVBQUUsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNsRyxTQUFTLENBQ1YsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLHVCQUFxQixJQUFJLENBQUMsV0FBVyxFQUFFLFNBQUksTUFBTSxDQUFDLFdBQVcsRUFBSSxDQUFDLEVBQ25HLFVBQVUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUNoQyxDQUFDO1NBQ1QsRUFDRCxVQUFDLEtBQUs7WUFDRixVQUFVLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hCLE9BQU8sVUFBVSxDQUFDO1NBQ3JCLENBQUMsQ0FBQztRQUNQLE9BQU8sVUFBVSxDQUFDOzs7Z0JBbkZ6QixVQUFVOzs7O2dCQUhGLHdCQUF3QjtnQkFIeEIsU0FBUztnQkFEVyxjQUFjO2dCQUdsQyxtQkFBbUI7Z0JBSG5CLGtCQUFrQjtnQkFDbEIsU0FBUzs7O3dCQVNiLE1BQU07OzZCQTlCWDs7U0E0QmEsa0JBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTYgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgSW5qZWN0YWJsZSwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1pbmltYWxOb2RlRW50cnlFbnRpdHksIE1pbmltYWxOb2RlRW50aXR5IH0gZnJvbSAnYWxmcmVzY28tanMtYXBpJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEFsZnJlc2NvQXBpU2VydmljZSwgQ29udGVudFNlcnZpY2UgfSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuXG5pbXBvcnQgeyBEb2N1bWVudExpc3RTZXJ2aWNlIH0gZnJvbSAnLi9kb2N1bWVudC1saXN0LnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29udGVudE5vZGVEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vY29udGVudC1ub2RlLXNlbGVjdG9yL2NvbnRlbnQtbm9kZS1kaWFsb2cuc2VydmljZSc7XG5pbXBvcnQgeyBOb2RlRG93bmxvYWREaXJlY3RpdmUgfSBmcm9tICcuLi8uLi9kaXJlY3RpdmVzL25vZGUtZG93bmxvYWQuZGlyZWN0aXZlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIE5vZGVBY3Rpb25zU2VydmljZSB7XG5cbiAgICBAT3V0cHV0KClcbiAgICBlcnJvcjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgY29udGVudERpYWxvZ1NlcnZpY2U6IENvbnRlbnROb2RlRGlhbG9nU2VydmljZSxcbiAgICAgICAgICAgICAgICBwdWJsaWMgZGlhbG9nUmVmOiBNYXREaWFsb2csXG4gICAgICAgICAgICAgICAgcHVibGljIGNvbnRlbnQ6IENvbnRlbnRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZG9jdW1lbnRMaXN0U2VydmljZT86IERvY3VtZW50TGlzdFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcGlTZXJ2aWNlPzogQWxmcmVzY29BcGlTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgZGlhbG9nPzogTWF0RGlhbG9nKSB7fVxuXG4gICAgZG93bmxvYWROb2RlKG5vZGU6IE1pbmltYWxOb2RlRW50aXR5KSB7XG4gICAgICAgIG5ldyBOb2RlRG93bmxvYWREaXJlY3RpdmUodGhpcy5hcGlTZXJ2aWNlLCB0aGlzLmRpYWxvZylcbiAgICAgICAgICAgIC5kb3dubG9hZE5vZGUobm9kZSk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29weSBjb250ZW50IG5vZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb250ZW50RW50cnkgbm9kZSB0byBjb3B5XG4gICAgICogQHBhcmFtIHBlcm1pc3Npb24gcGVybWlzc2lvbiB3aGljaCBpcyBuZWVkZWQgdG8gYXBwbHkgdGhlIGFjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBjb3B5Q29udGVudChjb250ZW50RW50cnk6IE1pbmltYWxOb2RlRW50cnlFbnRpdHksIHBlcm1pc3Npb24/OiBzdHJpbmcpOiBTdWJqZWN0PHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kb0ZpbGVPcGVyYXRpb24oJ2NvcHknLCAnY29udGVudCcsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ29weSBmb2xkZXIgbm9kZVxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbnRlbnRFbnRyeSBub2RlIHRvIGNvcHlcbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHVibGljIGNvcHlGb2xkZXIoY29udGVudEVudHJ5OiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5LCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9GaWxlT3BlcmF0aW9uKCdjb3B5JywgJ2ZvbGRlcicsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSBjb250ZW50IG5vZGVcbiAgICAgKlxuICAgICAqIEBwYXJhbSBjb250ZW50RW50cnkgbm9kZSB0byBtb3ZlXG4gICAgICogQHBhcmFtIHBlcm1pc3Npb24gcGVybWlzc2lvbiB3aGljaCBpcyBuZWVkZWQgdG8gYXBwbHkgdGhlIGFjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBtb3ZlQ29udGVudChjb250ZW50RW50cnk6IE1pbmltYWxOb2RlRW50cnlFbnRpdHksIHBlcm1pc3Npb24/OiBzdHJpbmcpOiBTdWJqZWN0PHN0cmluZz4ge1xuICAgICAgICByZXR1cm4gdGhpcy5kb0ZpbGVPcGVyYXRpb24oJ21vdmUnLCAnY29udGVudCcsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTW92ZSBmb2xkZXIgbm9kZVxuICAgICAqXG4gICAgICogQHBhcmFtIGNvbnRlbnRFbnRyeSBub2RlIHRvIG1vdmVcbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHVibGljIG1vdmVGb2xkZXIoY29udGVudEVudHJ5OiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5LCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9GaWxlT3BlcmF0aW9uKCdtb3ZlJywgJ2ZvbGRlcicsIGNvbnRlbnRFbnRyeSwgcGVybWlzc2lvbik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2VuZXJhbCBtZXRob2QgZm9yIHBlcmZvcm1pbmcgdGhlIGdpdmVuIG9wZXJhdGlvbiAoY29weXxtb3ZlKVxuICAgICAqXG4gICAgICogQHBhcmFtIGFjdGlvbiB0aGUgYWN0aW9uIHRvIHBlcmZvcm0gKGNvcHl8bW92ZSlcbiAgICAgKiBAcGFyYW0gdHlwZSB0eXBlIG9mIHRoZSBjb250ZW50IChjb250ZW50fGZvbGRlcilcbiAgICAgKiBAcGFyYW0gY29udGVudEVudHJ5IHRoZSBjb250ZW50RW50cnkgd2hpY2ggaGFzIHRvIGhhdmUgdGhlIGFjdGlvbiBwZXJmb3JtZWQgb25cbiAgICAgKiBAcGFyYW0gcGVybWlzc2lvbiBwZXJtaXNzaW9uIHdoaWNoIGlzIG5lZWRlZCB0byBhcHBseSB0aGUgYWN0aW9uXG4gICAgICovXG4gICAgcHJpdmF0ZSBkb0ZpbGVPcGVyYXRpb24oYWN0aW9uOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgY29udGVudEVudHJ5OiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5LCBwZXJtaXNzaW9uPzogc3RyaW5nKTogU3ViamVjdDxzdHJpbmc+IHtcbiAgICAgICAgY29uc3Qgb2JzZXJ2YWJsZTogU3ViamVjdDxzdHJpbmc+ID0gbmV3IFN1YmplY3Q8c3RyaW5nPigpO1xuXG4gICAgICAgIHRoaXMuY29udGVudERpYWxvZ1NlcnZpY2VcbiAgICAgICAgICAgIC5vcGVuQ29weU1vdmVEaWFsb2coYWN0aW9uLCBjb250ZW50RW50cnksIHBlcm1pc3Npb24pXG4gICAgICAgICAgICAuc3Vic2NyaWJlKChzZWxlY3Rpb25zOiBNaW5pbWFsTm9kZUVudHJ5RW50aXR5W10pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSBzZWxlY3Rpb25zWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRMaXN0U2VydmljZVtgJHthY3Rpb259Tm9kZWBdLmNhbGwodGhpcy5kb2N1bWVudExpc3RTZXJ2aWNlLCBjb250ZW50RW50cnkuaWQsIHNlbGVjdGlvbi5pZClcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2YWJsZS5uZXh0LmJpbmQob2JzZXJ2YWJsZSwgYE9QRVJBVElPTi5TVUNDRVNTLiR7dHlwZS50b1VwcGVyQ2FzZSgpfS4ke2FjdGlvbi50b1VwcGVyQ2FzZSgpfWApLFxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLmVycm9yLmJpbmQob2JzZXJ2YWJsZSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBvYnNlcnZhYmxlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gb2JzZXJ2YWJsZTtcbiAgICB9XG59XG4iXX0=