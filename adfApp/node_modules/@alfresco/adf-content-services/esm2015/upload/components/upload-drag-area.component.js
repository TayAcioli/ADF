/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2016 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { EXTENDIBLE_COMPONENT, FileUtils, NotificationService, TranslationService, UploadService, ContentService, PermissionsEnum } from '@alfresco/adf-core';
import { Component, forwardRef, Input, ViewEncapsulation, NgZone } from '@angular/core';
import { UploadBase } from './base-upload/upload-base';
export class UploadDragAreaComponent extends UploadBase {
    /**
     * @param {?} uploadService
     * @param {?} translationService
     * @param {?} notificationService
     * @param {?} contentService
     * @param {?} ngZone
     */
    constructor(uploadService, translationService, notificationService, contentService, ngZone) {
        super(uploadService, translationService, ngZone);
        this.uploadService = uploadService;
        this.translationService = translationService;
        this.notificationService = notificationService;
        this.contentService = contentService;
        this.ngZone = ngZone;
    }
    /**
     * ID of parent folder node
     * @deprecated 2.4.0 - use rootFolderId ID of parent folder node
     * @param {?} nodeId
     * @return {?}
     */
    set parentId(nodeId) {
        this.rootFolderId = nodeId;
    }
    /**
     * Method called when files are dropped in the drag area.
     *
     * @param {?} files - files dropped in the drag area.
     * @return {?}
     */
    onFilesDropped(files) {
        if (!this.disabled && files.length) {
            this.uploadFiles(files);
        }
    }
    /**
     * Called when the file are dropped in the drag area.
     * @deprecated in 2.4.0: use `onFilesDropped` instead
     * @param {?} item - FileEntity
     * @return {?}
     */
    onFilesEntityDropped(item) {
        if (!this.disabled) {
            item.file((file) => {
                // const fileModel = this.createFileModel(file, this.rootFolderId, item.fullPath.replace(item.name, ''));
                this.uploadFiles([file]);
            });
        }
    }
    /**
     * Called when a folder are dropped in the drag area
     *
     * @param {?} folder - name of the dropped folder
     * @return {?}
     */
    onFolderEntityDropped(folder) {
        if (!this.disabled && folder.isDirectory) {
            FileUtils.flattern(folder).then(filesInfo => {
                this.uploadFilesInfo(filesInfo);
            });
        }
    }
    /**
     * Show undo notification bar.
     *
     * @param {?} latestFilesAdded - files in the upload queue enriched with status flag and xhr object.
     * @return {?}
     */
    showUndoNotificationBar(latestFilesAdded) {
        /** @type {?} */
        let messageTranslate;
        /** @type {?} */
        let actionTranslate;
        messageTranslate = this.translationService.get('FILE_UPLOAD.MESSAGES.PROGRESS');
        actionTranslate = this.translationService.get('FILE_UPLOAD.ACTION.UNDO');
        this.notificationService.openSnackMessageAction(messageTranslate.value, actionTranslate.value, 3000).onAction().subscribe(() => {
            this.uploadService.cancelUpload(...latestFilesAdded);
        });
    }
    /**
     * Returns true or false considering the component options and node permissions
     * @return {?}
     */
    isDroppable() {
        return !this.disabled;
    }
    /**
     * Handles 'upload-files' events raised by child components.
     *
     * @param {?} event DOM event
     * @return {?}
     */
    onUploadFiles(event) {
        event.stopPropagation();
        event.preventDefault();
        /** @type {?} */
        let isAllowed = this.contentService.hasPermission(event.detail.data.obj.entry, PermissionsEnum.CREATE);
        if (isAllowed) {
            /** @type {?} */
            let fileInfo = event.detail.files;
            if (this.isTargetNodeFolder(event)) {
                /** @type {?} */
                const destinationFolderName = event.detail.data.obj.entry.name;
                fileInfo.map((file) => file.relativeFolder = destinationFolderName ? destinationFolderName.concat(file.relativeFolder) : file.relativeFolder);
            }
            if (fileInfo && fileInfo.length > 0) {
                this.uploadFilesInfo(fileInfo);
            }
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    isTargetNodeFolder(event) {
        return event.detail.data.obj && event.detail.data.obj.entry.isFolder;
    }
}
UploadDragAreaComponent.decorators = [
    { type: Component, args: [{
                selector: 'adf-upload-drag-area',
                template: "<div [file-draggable]=\"isDroppable()\" class=\"upload-border\"\n     (filesDropped)=\"onFilesDropped($event)\"\n     (folderEntityDropped)=\"onFolderEntityDropped($event)\"\n     (upload-files)=\"onUploadFiles($event)\"\n     dropzone=\"\" webkitdropzone=\"*\" #droparea>\n    <ng-content></ng-content>\n</div>\n",
                host: { 'class': 'adf-upload-drag-area' },
                viewProviders: [
                    { provide: EXTENDIBLE_COMPONENT, useExisting: forwardRef(() => UploadDragAreaComponent) }
                ],
                encapsulation: ViewEncapsulation.None,
                styles: ["adf-upload-drag-area{overflow:hidden}.upload-border{vertical-align:middle;text-align:center;width:100%;box-sizing:border-box}.file-draggable__input-focus{color:#2196f3;border:1px dashed #2196f3}"]
            }] }
];
/** @nocollapse */
UploadDragAreaComponent.ctorParameters = () => [
    { type: UploadService },
    { type: TranslationService },
    { type: NotificationService },
    { type: ContentService },
    { type: NgZone }
];
UploadDragAreaComponent.propDecorators = {
    parentId: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    UploadDragAreaComponent.prototype.uploadService;
    /** @type {?} */
    UploadDragAreaComponent.prototype.translationService;
    /** @type {?} */
    UploadDragAreaComponent.prototype.notificationService;
    /** @type {?} */
    UploadDragAreaComponent.prototype.contentService;
    /** @type {?} */
    UploadDragAreaComponent.prototype.ngZone;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXBsb2FkLWRyYWctYXJlYS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJ1cGxvYWQvY29tcG9uZW50cy91cGxvYWQtZHJhZy1hcmVhLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQ0gsb0JBQW9CLEVBQXVCLFNBQVMsRUFDcEQsbUJBQW1CLEVBQUUsa0JBQWtCLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQzFGLE1BQU0sb0JBQW9CLENBQUM7QUFDNUIsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN4RixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFZdkQsTUFBTSw4QkFBK0IsU0FBUSxVQUFVOzs7Ozs7OztJQVduRCxZQUFzQixhQUE0QixFQUM1QixrQkFBc0MsRUFDeEMscUJBQ0EsZ0JBQ0UsTUFBYztRQUNoQyxLQUFLLENBQUMsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBTC9CLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDeEMsd0JBQW1CLEdBQW5CLG1CQUFtQjtRQUNuQixtQkFBYyxHQUFkLGNBQWM7UUFDWixXQUFNLEdBQU4sTUFBTSxDQUFRO0tBRW5DOzs7Ozs7O0lBWEQsSUFDSSxRQUFRLENBQUMsTUFBYztRQUN2QixJQUFJLENBQUMsWUFBWSxHQUFHLE1BQU0sQ0FBQztLQUM5Qjs7Ozs7OztJQWVELGNBQWMsQ0FBQyxLQUFhO1FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUU7WUFDaEMsSUFBSSxDQUFDLFdB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RSxzQkFBc0I7Z0JBQ2hDLHFVQUFnRDtnQkFFaEQsSUFBSSxFQUFFLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFO2dCQUN6QyxhQUFhLEVBQUU7b0JBQ1gsRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxFQUFFO2lCQUM1RjtnQkFDRCxhQUFhLEVBQUUsaUJBQWlCLENBQUMsSUFBSTs7YUFDeEM7Ozs7WUFkNEMsYUFBYTtZQUFqQyxrQkFBa0I7WUFBdkMsbUJBQW1CO1lBQXFDLGNBQWM7WUFFaEIsTUFBTTs7O3VCQW1CM0QsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE2IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gICAgRVhURU5ESUJMRV9DT01QT05FTlQsIEZpbGVJbmZvLCBGaWxlTW9kZWwsIEZpbGVVdGlscywgTm9kZVBlcm1pc3Npb25TdWJqZWN0LFxuICAgIE5vdGlmaWNhdGlvblNlcnZpY2UsIFRyYW5zbGF0aW9uU2VydmljZSwgVXBsb2FkU2VydmljZSwgQ29udGVudFNlcnZpY2UsIFBlcm1pc3Npb25zRW51bVxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBmb3J3YXJkUmVmLCBJbnB1dCwgVmlld0VuY2Fwc3VsYXRpb24sIE5nWm9uZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVXBsb2FkQmFzZSB9IGZyb20gJy4vYmFzZS11cGxvYWQvdXBsb2FkLWJhc2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi11cGxvYWQtZHJhZy1hcmVhJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdXBsb2FkLWRyYWctYXJlYS5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vdXBsb2FkLWRyYWctYXJlYS5jb21wb25lbnQuY3NzJ10sXG4gICAgaG9zdDogeyAnY2xhc3MnOiAnYWRmLXVwbG9hZC1kcmFnLWFyZWEnIH0sXG4gICAgdmlld1Byb3ZpZGVyczogW1xuICAgICAgICB7IHByb3ZpZGU6IEVYVEVORElCTEVfQ09NUE9ORU5ULCB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBVcGxvYWREcmFnQXJlYUNvbXBvbmVudCkgfVxuICAgIF0sXG4gICAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBVcGxvYWREcmFnQXJlYUNvbXBvbmVudCBleHRlbmRzIFVwbG9hZEJhc2UgaW1wbGVtZW50cyBOb2RlUGVybWlzc2lvblN1YmplY3Qge1xuXG4gICAgLyoqXG4gICAgICogSUQgb2YgcGFyZW50IGZvbGRlciBub2RlXG4gICAgICogQGRlcHJlY2F0ZWQgMi40LjAgLSB1c2Ugcm9vdEZvbGRlcklkIElEIG9mIHBhcmVudCBmb2xkZXIgbm9kZVxuICAgICAqL1xuICAgIEBJbnB1dCgpXG4gICAgc2V0IHBhcmVudElkKG5vZGVJZDogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMucm9vdEZvbGRlcklkID0gbm9kZUlkO1xuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByb3RlY3RlZCB1cGxvYWRTZXJ2aWNlOiBVcGxvYWRTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByb3RlY3RlZCB0cmFuc2xhdGlvblNlcnZpY2U6IFRyYW5zbGF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIG5vdGlmaWNhdGlvblNlcnZpY2U6IE5vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBjb250ZW50U2VydmljZTogQ29udGVudFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIG5nWm9uZTogTmdab25lKSB7XG4gICAgICAgIHN1cGVyKHVwbG9hZFNlcnZpY2UsIHRyYW5zbGF0aW9uU2VydmljZSwgbmdab25lKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBNZXRob2QgY2FsbGVkIHdoZW4gZmlsZXMgYXJlIGRyb3BwZWQgaW4gdGhlIGRyYWcgYXJlYS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWxlcyAtIGZpbGVzIGRyb3BwZWQgaW4gdGhlIGRyYWcgYXJlYS5cbiAgICAgKi9cbiAgICBvbkZpbGVzRHJvcHBlZChmaWxlczogRmlsZVtdKTogdm9pZCB7XG4gICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiBmaWxlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZXMoZmlsZXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gdGhlIGZpbGUgYXJlIGRyb3BwZWQgaW4gdGhlIGRyYWcgYXJlYS5cbiAgICAgKiBAZGVwcmVjYXRlZCBpbiAyLjQuMDogdXNlIGBvbkZpbGVzRHJvcHBlZGAgaW5zdGVhZFxuICAgICAqIEBwYXJhbSBpdGVtIC0gRmlsZUVudGl0eVxuICAgICAqL1xuICAgIG9uRmlsZXNFbnRpdHlEcm9wcGVkKGl0ZW06IGFueSk6IHZvaWQge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIGl0ZW0uZmlsZSgoZmlsZTogRmlsZSkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIGNvbnN0IGZpbGVNb2RlbCA9IHRoaXMuY3JlYXRlRmlsZU1vZGVsKGZpbGUsIHRoaXMucm9vdEZvbGRlcklkLCBpdGVtLmZ1bGxQYXRoLnJlcGxhY2UoaXRlbS5uYW1lLCAnJykpO1xuXG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRGaWxlcyhbZmlsZV0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgd2hlbiBhIGZvbGRlciBhcmUgZHJvcHBlZCBpbiB0aGUgZHJhZyBhcmVhXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZm9sZGVyIC0gbmFtZSBvZiB0aGUgZHJvcHBlZCBmb2xkZXJcbiAgICAgKi9cbiAgICBvbkZvbGRlckVudGl0eURyb3BwZWQoZm9sZGVyOiBhbnkpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIGZvbGRlci5pc0RpcmVjdG9yeSkge1xuICAgICAgICAgICAgRmlsZVV0aWxzLmZsYXR0ZXJuKGZvbGRlcikudGhlbihmaWxlc0luZm8gPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZXNJbmZvKGZpbGVzSW5mbyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFNob3cgdW5kbyBub3RpZmljYXRpb24gYmFyLlxuICAgICAqXG4gICAgICogQHBhcmFtIGxhdGVzdEZpbGVzQWRkZWQgLSBmaWxlcyBpbiB0aGUgdXBsb2FkIHF1ZXVlIGVucmljaGVkIHdpdGggc3RhdHVzIGZsYWcgYW5kIHhociBvYmplY3QuXG4gICAgICovXG4gICAgc2hvd1VuZG9Ob3RpZmljYXRpb25CYXIobGF0ZXN0RmlsZXNBZGRlZDogRmlsZU1vZGVsW10pIHtcbiAgICAgICAgbGV0IG1lc3NhZ2VUcmFuc2xhdGU6IGFueSwgYWN0aW9uVHJhbnNsYXRlOiBhbnk7XG4gICAgICAgIG1lc3NhZ2VUcmFuc2xhdGUgPSB0aGlzLnRyYW5zbGF0aW9uU2VydmljZS5nZXQoJ0ZJTEVfVVBMT0FELk1FU1NBR0VTLlBST0dSRVNTJyk7XG4gICAgICAgIGFjdGlvblRyYW5zbGF0ZSA9IHRoaXMudHJhbnNsYXRpb25TZXJ2aWNlLmdldCgnRklMRV9VUExPQUQuQUNUSU9OLlVORE8nKTtcblxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvblNlcnZpY2Uub3BlblNuYWNrTWVzc2FnZUFjdGlvbihtZXNzYWdlVHJhbnNsYXRlLnZhbHVlLCBhY3Rpb25UcmFuc2xhdGUudmFsdWUsIDMwMDApLm9uQWN0aW9uKCkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5jYW5jZWxVcGxvYWQoLi4ubGF0ZXN0RmlsZXNBZGRlZCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKiBSZXR1cm5zIHRydWUgb3IgZmFsc2UgY29uc2lkZXJpbmcgdGhlIGNvbXBvbmVudCBvcHRpb25zIGFuZCBub2RlIHBlcm1pc3Npb25zICovXG4gICAgaXNEcm9wcGFibGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhdGhpcy5kaXNhYmxlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzICd1cGxvYWQtZmlsZXMnIGV2ZW50cyByYWlzZWQgYnkgY2hpbGQgY29tcG9uZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudCBET00gZXZlbnRcbiAgICAgKi9cbiAgICBvblVwbG9hZEZpbGVzKGV2ZW50OiBDdXN0b21FdmVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgbGV0IGlzQWxsb3dlZDogYm9vbGVhbiA9IHRoaXMuY29udGVudFNlcnZpY2UuaGFzUGVybWlzc2lvbihldmVudC5kZXRhaWwuZGF0YS5vYmouZW50cnksIFBlcm1pc3Npb25zRW51bS5DUkVBVEUpO1xuICAgICAgICBpZiAoaXNBbGxvd2VkKSB7XG4gICAgICAgICAgICBsZXQgZmlsZUluZm86IEZpbGVJbmZvW10gPSBldmVudC5kZXRhaWwuZmlsZXM7XG4gICAgICAgICAgICBpZiAodGhpcy5pc1RhcmdldE5vZGVGb2xkZXIoZXZlbnQpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25Gb2xkZXJOYW1lID0gZXZlbnQuZGV0YWlsLmRhdGEub2JqLmVudHJ5Lm5hbWU7XG4gICAgICAgICAgICAgICAgZmlsZUluZm8ubWFwKChmaWxlKSA9PiBmaWxlLnJlbGF0aXZlRm9sZGVyID0gZGVzdGluYXRpb25Gb2xkZXJOYW1lID8gZGVzdGluYXRpb25Gb2xkZXJOYW1lLmNvbmNhdChmaWxlLnJlbGF0aXZlRm9sZGVyKSA6IGZpbGUucmVsYXRpdmVGb2xkZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpbGVJbmZvICYmIGZpbGVJbmZvLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVzSW5mbyhmaWxlSW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGlzVGFyZ2V0Tm9kZUZvbGRlcihldmVudDogQ3VzdG9tRXZlbnQpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIGV2ZW50LmRldGFpbC5kYXRhLm9iaiAmJiBldmVudC5kZXRhaWwuZGF0YS5vYmouZW50cnkuaXNGb2xkZXI7XG4gICAgfVxuXG59XG4iXX0=